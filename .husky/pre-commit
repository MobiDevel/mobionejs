#!/usr/bin/env bash
set -euo pipefail

echo "ğŸ¤“ husky(pre-commit): quality gate (mobione-sdk)"

if git diff --cached --quiet; then
    echo "â„¹ï¸  No staged changes; skipping"
    exit 0
fi

echo "ğŸ“¦ Ensuring dependencies installed (prepare may have run)"
npm ls >/dev/null 2>&1 || npm install --no-audit --no-fund

echo "ğŸ§ª Tests (fast)"
if npm run test:dev --silent; then
    echo "âœ… Tests ok"
else
    echo "âŒ Tests failed"; exit 1
fi

echo "ğŸ§¹ Lint + format"
if npm run lint --silent; then
    echo "âœ… Lint ok"
else
    echo "âŒ Lint failed"; exit 1
fi

echo "ğŸ“– TOC refresh"
if npm run docs:toc --silent; then
    echo "âœ… TOC ok"
else
    echo "âŒ TOC update failed"; exit 1
fi

echo "ğŸ” Type/build (tsc)"
if npm run build --silent; then
    echo "âœ… Build ok"
else
    echo "âŒ Build failed"; exit 1
fi

echo "ğŸ›¡  Legacy import guard"
if npm run check:legacy-imports --silent; then
    echo "âœ… Legacy imports clean"
else
    echo "âŒ Legacy import violations"; exit 1
fi

echo "ğŸš€ pre-commit passed"



